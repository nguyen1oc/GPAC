<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>GPA Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f7fafd;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 32px 40px 24px 40px;
        }
        h2 {
            color: #2a5298;
            margin-top: 0;
            letter-spacing: 1px;
        }
        form {
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        label {
            font-weight: 500;
            color: #2a5298;
            align-self: flex-start;
        }
        textarea {
            width: 100%;
            max-width: 100%;
            min-width: 200px;
            height: 180px;
            border: 1.5px solid #b6c6e0;
            border-radius: 8px;
            padding: 10px;
            font-size: 1em;
            margin-top: 6px;
            margin-bottom: 12px;
            background: #f4f8fb;
            transition: border 0.2s;
            box-sizing: border-box;
        }
        textarea:focus {
            border: 1.5px solid #2a5298;
            outline: none;
        }
        button {
            background: linear-gradient(90deg, #2a5298 0%, #1e3c72 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 28px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(42,82,152,0.08);
            transition: background 0.2s, box-shadow 0.2s;
            align-self: flex-start;
            min-width: 220px;
        }
        button:hover {
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            box-shadow: 0 4px 16px rgba(42,82,152,0.12);
        }
        .info-card {
            background: #eaf1fb;
            border-radius: 10px;
            padding: 18px 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(42,82,152,0.04);
        }
        .info-card strong {
            color: #1e3c72;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(42,82,152,0.04);
        }
        th, td {
            border: none;
            padding: 10px 12px;
            text-align: left;
        }
        th {
            background: #2a5298;
            color: #fff;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f4f8fb;
        }
        tr:hover {
            background: #eaf1fb;
        }
        .gpa {
            margin-top: 24px;
            font-size: 1.15em;
            background: #f4f8fb;
            border-radius: 8px;
            padding: 16px 20px;
            color: #1e3c72;
            box-shadow: 0 1px 4px rgba(42,82,152,0.04);
        }
        .center-btn {
            display: flex;
            justify-content: center;
            margin-bottom: 18px;
            gap: 16px;
            margin-top: 12px
        }
        .edit-input {
            border: 1px solid #b6c6e0;
            border-radius: 6px;
            padding: 1px 4px;
            font-size: 0.95em;
            background: #fff;
            box-sizing: border-box;
            outline: none;
            width: 40px;
            min-width: 30px;
            max-width: 60px;
            height: 22px;
            margin: 0;
            vertical-align: middle;
        }
        .edit-input:focus {
            border: 1.5px solid #2a5298;
            box-shadow: none;
        }
        .editable.can-edit, .editable.can-edit:hover {
            background: none;
            font-weight: normal;
            cursor: pointer;
        }
        @media (max-width: 600px) {
            .container { padding: 10px; }
            th, td { font-size: 0.95em; padding: 7px 6px; }
            .info-card, .gpa { padding: 10px 8px; }
            .center-btn { margin-bottom: 10px; }
        }
        .credit {
            position: fixed;
            right: 32px;
            bottom: 18px;
            color: #888;
            font-size: 1em;
            font-family: 'Segoe UI', Arial, sans-serif;
            opacity: 0.85;
            z-index: 100;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>GPA Calculator</h2>
        <form id="input-form">
            <label>Paste bảng điểm:</label><br>
            <textarea id="gpa_text" required></textarea><br>
            <button type="submit">Phân tích & Tính GPA</button>
        </form>
        <div id="result-area" style="display:none;"></div>
        <div class="center-btn" id="action-btns" style="display:none;">
            <button id="recalc-btn" style="display:none;">Tính lại GPA</button>
            <button id="reset-btn">Nhập lại bảng điểm</button>
        </div>
    </div>
    <div class="credit">credit: nguyen1oc</div>
    <script>
    // --- GPA logic in JS ---
    const letter_to_4 = {
        'A+': 4.0, 'A': 4.0, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D+': 1.5, 'D': 1.0, 'F': 0.0
    };
    function parseGpaText(text) {
        const info = {name: '', mssv: '', major: '', class: ''};
        info.name = (text.match(/Họ và tên:\s*(.+)/) || [,''])[1].trim();
        info.mssv = (text.match(/Mã sinh viên:\s*(\d+)/) || [,''])[1].trim();
        info.major = (text.match(/Ngành:\s*(.+)/) || [,''])[1].trim();
        info.class = (text.match(/Mã lớp:\s*(\w+)/) || [,''])[1].trim();
        const subjects = [];
        text.split(/\r?\n/).forEach(line => {
            if (!/[A-Z]{2}\d{4,}/.test(line)) return;
            const parts = line.trim().split(/\t+|\s{2,}/);
            if (parts.length < 6) return;
            let score_10 = parts[3] !== '--' ? parseFloat(parts[3]) : '';
            if (isNaN(score_10)) score_10 = '';
            const letter = parts[4];
            let credits = parseInt(parts[5]);
            if (isNaN(credits)) credits = 0;
            subjects.push({
                code: parts[1],
                name: parts[2],
                score_10: score_10,
                letter: letter,
                credits: credits
            });
        });
        return {info, subjects};
    }
    function calculateGPA(subjects) {
        let total_4 = 0, total_credits_4 = 0;
        let total_10 = 0, total_credits_10 = 0;
        let total_credits = 0;
        for (const subj of subjects) {
            const code = subj.code || '';
            const credits = subj.credits;
            const score_10 = subj.score_10;
            const letter = subj.letter;
            const valid_10 = score_10 !== '' && !isNaN(score_10);
            const valid_4 = letter_to_4.hasOwnProperty(letter);
            const is_english = code.startsWith('LA');
            let count_credit = false;
            if (credits > 0) {
                if (is_english) {
                    if ((valid_10 && valid_4 && letter !== 'F') || (score_10 == 12 && (!letter || letter === '--')))
                        count_credit = true;
                } else {
                    if (valid_10 && valid_4 && letter !== 'F')
                        count_credit = true;
                }
            }
            if (count_credit) total_credits += credits;
            if (valid_4 && credits > 0) {
                total_4 += letter_to_4[letter] * credits;
                total_credits_4 += credits;
            }
            if (valid_10 && credits > 0 && !is_english) {
                total_10 += score_10 * credits;
                total_credits_10 += credits;
            }
        }
        const gpa_4 = total_credits_4 > 0 ? total_4 / total_credits_4 : 0;
        const gpa_10 = total_credits_10 > 0 ? total_10 / total_credits_10 : 0;
        return {gpa_4, gpa_10, total_credits};
    }
    // --- UI logic ---
    const inputForm = document.getElementById('input-form');
    const gpaText = document.getElementById('gpa_text');
    const resultArea = document.getElementById('result-area');
    const recalcBtn = document.getElementById('recalc-btn');
    const resetBtn = document.getElementById('reset-btn');
    const actionBtns = document.getElementById('action-btns');
    let currentSubjects = [];
    let currentInfo = {};
    inputForm.onsubmit = function(e) {
        e.preventDefault();
        const text = gpaText.value;
        const {info, subjects} = parseGpaText(text);
        currentSubjects = subjects;
        currentInfo = info;
        renderResult();
    };
    function renderResult() {
        const {gpa_4, gpa_10, total_credits} = calculateGPA(currentSubjects);
        let html = '';
        html += `<div class="info-card">
            <strong>Họ tên:</strong> ${currentInfo.name}<br>
            <strong>MSSV:</strong> ${currentInfo.mssv}<br>
            <strong>Ngành:</strong> ${currentInfo.major}<br>
            <strong>Lớp:</strong> ${currentInfo.class}<br>
        </div>`;
        html += `<table id="subjects-table">
            <tr>
                <th>Mã môn</th><th>Tên môn</th><th>Điểm 10</th><th>Điểm chữ</th><th>Tín chỉ</th>
            </tr>`;
        currentSubjects.forEach((s, i) => {
            html += `<tr>
                <td>${s.code}</td>
                <td>${s.name}</td>
                <td class="editable" data-type="score_10" data-index="${i}">${s.score_10 !== '' ? s.score_10 : ''}</td>
                <td class="editable" data-type="letter" data-index="${i}">${s.letter}</td>
                <td>${s.credits}</td>
            </tr>`;
        });
        html += `</table>`;
        html += `<div class="gpa">
            <strong>GPA thang 4:</strong> ${gpa_4.toFixed(2)}<br>
            <strong>GPA thang 10:</strong> ${gpa_10.toFixed(2)}<br>
            <strong>Tổng tín chỉ tích lũy:</strong> ${total_credits}
        </div>`;
        resultArea.innerHTML = html;
        resultArea.style.display = 'block';
        actionBtns.style.display = 'flex';
        recalcBtn.style.display = 'none';
        attachEditEvents();
    }
    function attachEditEvents() {
        document.querySelectorAll('.editable').forEach(cell => {
            cell.ondblclick = function() {
                if (cell.querySelector('input')) return;
                const idx = parseInt(cell.getAttribute('data-index'));
                const type = cell.getAttribute('data-type');
                const oldValue = cell.innerText;
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'edit-input';
                input.value = oldValue;
                input.onblur = function() {
                    cell.innerText = input.value;
                    if (type === 'score_10') {
                        currentSubjects[idx].score_10 = input.value !== '' ? parseFloat(input.value) : '';
                    } else if (type === 'letter') {
                        currentSubjects[idx].letter = input.value;
                    }
                    recalcBtn.style.display = 'inline-block';
                };
                input.onkeydown = function(e) {
                    if (e.key === 'Enter') input.blur();
                };
                cell.innerText = '';
                cell.appendChild(input);
                input.focus();
            };
        });
    }
    recalcBtn.onclick = function() {
        renderResult();
    };
    resetBtn.onclick = function() {
        resultArea.style.display = 'none';
        actionBtns.style.display = 'none';
        gpaText.value = '';
        inputForm.style.display = 'flex';
        currentSubjects = [];
        currentInfo = {};
        };
        </script>
</body>
</html> 
